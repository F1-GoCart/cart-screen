import * as React from "react";
import { View, Text, Image, StyleSheet } from "react-native";
import Svg, { Path } from "react-native-svg";
import { Confetti } from "react-native-fast-confetti";
import { useTimer } from "react-timer-hook";
import { router } from "expo-router";
import { supabase } from "~/lib/supabase";
import { cart_id } from "~/lib/constants";

const PaymentSuccess = () => {
  const successTime = new Date();
  successTime.setSeconds(successTime.getSeconds() + 10);
  const { seconds: successSeconds } = useTimer({
    expiryTimestamp: successTime,
    onExpire: async () => {
      const { error } = await supabase
        .from("shopping_carts")
        .update({ status: "not_in_use", user_id: null })
        .eq("cart_id", cart_id);

      if (error) {
        console.error("Error updating cart status", error);
      }

      const cart_number = parseInt(cart_id.replace("go-cart-", ""));

      const { error: scannedItemsError } = await supabase
        .from("scanned_items")
        .delete()
        .eq("cart_id", cart_number);
      if (scannedItemsError) {
        console.error("Error deleting scanned items", scannedItemsError);
      }

      router.push("/login");
    },
  });

  return (
    <>
      <Confetti isInfinite={false} />
      <View style={styles.container}>
        <Svg width="572" height="126" viewBox="0 0 572 126" fill="none">
          <Path
            d="M201.495 54V26H212.535C219.095 26 223.175 29.72 223.175 35.36V35.44C223.175 41.68 218.175 45 211.975 45H206.415V54H201.495ZM206.415 40.56H212.135C215.855 40.56 218.175 38.48 218.175 35.56V35.48C218.175 32.16 215.815 30.48 212.135 30.48H206.415V40.56ZM233.343 54.44C229.383 54.44 225.823 52.2 225.823 47.92V47.84C225.823 43.24 229.423 41.04 234.583 41.04C236.983 41.04 238.623 41.4 240.263 41.92V41.4C240.263 38.36 238.423 36.8 235.023 36.8C232.623 36.8 230.903 37.32 228.983 38.12L227.663 34.32C230.023 33.32 232.303 32.6 235.663 32.6C238.823 32.6 241.143 33.4 242.663 34.96C244.223 36.52 244.943 38.72 244.943 41.48V54H240.223V51.36C238.783 53.08 236.583 54.44 233.343 54.44ZM234.703 50.92C237.903 50.92 240.343 49.12 240.343 46.4V44.96C239.103 44.48 237.463 44.12 235.543 44.12C232.383 44.12 230.583 45.4 230.583 47.64V47.72C230.583 49.76 232.343 50.92 234.703 50.92ZM259.078 48.56L264.598 32.88H269.638L261.238 54.56C259.518 58.92 257.678 60.52 254.278 60.52C252.238 60.52 250.758 60.04 249.278 59.2L250.918 55.64C251.838 56.12 252.758 56.44 253.758 56.44C255.158 56.44 255.958 55.84 256.758 54.04L247.958 32.88H253.158L259.078 48.56ZM273.746 54V32.88H278.626V36.08C279.986 34.2 281.826 32.44 285.066 32.44C288.106 32.44 290.266 33.92 291.386 36.16C293.106 33.92 295.306 32.44 298.506 32.44C303.146 32.44 305.906 35.36 305.906 40.52V54H301.066V42C301.066 38.64 299.506 36.84 296.786 36.84C294.106 36.84 292.266 38.68 292.266 42.08V54H287.426V41.96C287.426 38.64 285.866 36.84 283.146 36.84C280.426 36.84 278.626 38.84 278.626 42.08V54H273.746ZM321.435 54.48C315.355 54.48 310.595 50.04 310.595 43.52V43.44C310.595 37.36 314.875 32.44 320.915 32.44C327.635 32.44 331.035 37.72 331.035 43.8C331.035 44.24 330.995 44.68 330.955 45.16H315.435C315.955 48.64 318.355 50.52 321.515 50.52C323.915 50.52 325.515 49.64 327.235 48L330.075 50.52C328.035 52.92 325.315 54.48 321.435 54.48ZM315.395 41.96H326.235C325.915 38.88 324.075 36.4 320.875 36.4C317.875 36.4 315.835 38.64 315.395 41.96ZM335.855 54V32.88H340.735V36.12C342.135 34.16 344.015 32.44 347.335 32.44C352.135 32.44 354.855 35.6 354.855 40.52V54H350.015V42C350.015 38.68 348.375 36.84 345.495 36.84C342.655 36.84 340.735 38.76 340.735 42.08V54H335.855ZM367.78 54.36C364.22 54.36 361.7 52.8 361.7 48.16V37.04H359.02V32.88H361.7V27.08H366.54V32.88H372.22V37.04H366.54V47.4C366.54 49.28 367.5 50.04 369.14 50.04C370.18 50.04 371.18 49.8 372.14 49.32V53.28C370.9 53.96 369.66 54.36 367.78 54.36ZM182.349 102.4C178.029 102.4 174.029 100.96 170.669 97.92L173.629 94.4C176.349 96.76 178.989 98.04 182.469 98.04C185.509 98.04 187.429 96.6 187.429 94.52V94.44C187.429 92.48 186.309 91.32 181.109 90.16C175.149 88.76 171.789 86.92 171.789 81.8V81.72C171.789 76.92 175.789 73.6 181.349 73.6C185.469 73.6 188.629 74.84 191.509 77.12L188.869 80.84C186.309 78.96 183.829 77.96 181.269 77.96C178.389 77.96 176.709 79.4 176.709 81.28V81.36C176.709 83.52 177.989 84.48 183.389 85.76C189.269 87.28 192.349 89.28 192.349 93.96V94.04C192.349 99.32 188.229 102.4 182.349 102.4ZM204.855 102.44C200.055 102.44 197.335 99.28 197.335 94.32V80.88H202.175V92.88C202.175 96.2 203.815 98 206.695 98C209.535 98 211.455 96.12 211.455 92.8V80.88H216.335V102H211.455V98.72C210.055 100.76 208.095 102.44 204.855 102.44ZM232.14 102.48C225.86 102.48 221.22 97.56 221.22 91.56V91.48C221.22 85.48 225.86 80.44 232.22 80.44C236.18 80.44 238.62 81.92 240.66 84.08L237.62 87.32C236.14 85.76 234.58 84.68 232.18 84.68C228.66 84.68 226.06 87.72 226.06 91.4V91.48C226.06 95.24 228.66 98.24 232.38 98.24C234.66 98.24 236.3 97.2 237.86 95.64L240.78 98.52C238.7 100.88 236.26 102.48 232.14 102.48ZM254.405 102.48C248.125 102.48 243.485 97.56 243.485 91.56V91.48C243.485 85.48 248.125 80.44 254.485 80.44C258.445 80.44 260.885 81.92 262.925 84.08L259.885 87.32C258.405 85.76 256.845 84.68 254.445 84.68C250.925 84.68 248.325 87.72 248.325 91.4V91.48C248.325 95.24 250.925 98.24 254.645 98.24C256.925 98.24 258.565 97.2 260.125 95.64L263.045 98.52C260.965 100.88 258.525 102.48 254.405 102.48ZM276.591 102.48C270.511 102.48 265.751 98.04 265.751 91.52V91.44C265.751 85.36 270.031 80.44 276.071 80.44C282.791 80.44 286.191 85.72 286.191 91.8C286.191 92.24 286.151 92.68 286.111 93.16H270.591C271.111 96.64 273.511 98.52 276.671 98.52C279.071 98.52 280.671 97.64 282.391 96L285.231 98.52C283.191 100.92 280.471 102.48 276.591 102.48ZM270.551 89.96H281.391C281.071 86.88 279.231 84.4 276.031 84.4C273.031 84.4 270.991 86.64 270.551 89.96ZM298.292 102.4C295.252 102.4 292.012 101.36 289.332 99.24L291.492 95.96C293.852 97.68 296.212 98.56 298.412 98.56C300.492 98.56 301.692 97.68 301.692 96.28V96.2C301.692 94.6 299.452 94 296.972 93.24C293.892 92.4 290.372 91.08 290.372 87.08V87C290.372 82.96 293.692 80.52 297.892 80.52C300.572 80.52 303.412 81.44 305.652 82.92L303.732 86.36C301.692 85.12 299.532 84.36 297.772 84.36C295.892 84.36 294.812 85.28 294.812 86.44V86.52C294.812 88.04 297.092 88.76 299.572 89.52C302.612 90.48 306.132 91.88 306.132 95.68V95.76C306.132 100.2 302.692 102.4 298.292 102.4ZM317.94 102.4C314.9 102.4 311.66 101.36 308.98 99.24L311.14 95.96C313.5 97.68 315.86 98.56 318.06 98.56C320.14 98.56 321.34 97.68 321.34 96.28V96.2C321.34 94.6 319.1 94 316.62 93.24C313.54 92.4 310.02 91.08 310.02 87.08V87C310.02 82.96 313.34 80.52 317.54 80.52C320.22 80.52 323.06 81.44 325.3 82.92L323.38 86.36C321.34 85.12 319.18 84.36 317.42 84.36C315.54 84.36 314.46 85.28 314.46 86.44V86.52C314.46 88.04 316.74 88.76 319.22 89.52C322.26 90.48 325.78 91.88 325.78 95.68V95.76C325.78 100.2 322.34 102.4 317.94 102.4ZM331.819 102V85.04H329.139V81H331.819V79.44C331.819 77.12 332.379 75.4 333.539 74.24C334.659 73.12 336.219 72.56 338.259 72.56C339.979 72.56 341.139 72.8 342.219 73.12V77.2C341.259 76.88 340.459 76.68 339.379 76.68C337.499 76.68 336.579 77.76 336.579 79.88V81.04H342.179V85.04H336.659V102H331.819ZM353.058 102.44C348.258 102.44 345.538 99.28 345.538 94.32V80.88H350.378V92.88C350.378 96.2 352.018 98 354.898 98C357.738 98 359.658 96.12 359.658 92.8V80.88H364.538V102H359.658V98.72C358.258 100.76 356.298 102.44 353.058 102.44ZM370.823 102V72.8H375.703V102H370.823ZM383.708 93.12L382.188 75.4V74H387.868V75.4L386.388 93.12H383.708ZM382.388 102V96.48H387.708V102H382.388Z"
            fill="white"
          />
          <Path
            d="M30.45 59.325L10.5 115.5L66.675 95.6025M21 15.75H21.0525M115.5 42H115.553M78.75 10.5H78.8025M115.5 105H115.553M115.5 10.5L103.74 14.4375C100.393 15.5525 97.5362 17.7956 95.6593 20.7833C93.7824 23.771 93.0015 27.3178 93.45 30.8175C93.975 35.3325 90.4575 39.375 85.8375 39.375H83.8425C79.3275 39.375 75.4425 42.525 74.6025 46.935L73.5 52.5M115.5 68.25L111.195 66.5175C106.68 64.7325 101.64 67.5675 100.8 72.345C100.223 76.02 97.02 78.75 93.2925 78.75H89.25M57.75 10.5L59.4825 14.805C61.2675 19.32 58.4325 24.36 53.655 25.2C49.98 25.725 47.25 28.98 47.25 32.7075V36.75"
            stroke="white"
            stroke-width="10"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
          <Path
            d="M57.75 68.25C67.8825 78.3825 72.6075 90.1425 68.25 94.5C63.8925 98.8575 52.1325 94.1325 42 84C31.8675 73.8675 27.1425 62.1075 31.5 57.75C35.8575 53.3925 47.6175 58.1175 57.75 68.25Z"
            stroke="white"
            stroke-width="10"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
          <Path
            d="M541.55 59.325L561.5 115.5L505.325 95.6025M551 15.75H550.947M456.5 42H456.447M493.25 10.5H493.197M456.5 105H456.447M456.5 10.5L468.26 14.4375C471.607 15.5525 474.464 17.7956 476.341 20.7833C478.218 23.771 478.998 27.3178 478.55 30.8175C478.025 35.3325 481.542 39.375 486.162 39.375H488.157C492.672 39.375 496.557 42.525 497.397 46.935L498.5 52.5M456.5 68.25L460.805 66.5175C465.32 64.7325 470.36 67.5675 471.2 72.345C471.777 76.02 474.98 78.75 478.707 78.75H482.75M514.25 10.5L512.518 14.805C510.733 19.32 513.567 24.36 518.345 25.2C522.02 25.725 524.75 28.98 524.75 32.7075V36.75"
            stroke="white"
            stroke-width="10"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
          <Path
            d="M514.25 68.25C504.118 78.3825 499.393 90.1425 503.75 94.5C508.108 98.8575 519.868 94.1325 530 84C540.133 73.8675 544.858 62.1075 540.5 57.75C536.143 53.3925 524.383 58.1175 514.25 68.25Z"
            stroke="white"
            stroke-width="10"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </Svg>

        <Text style={styles.headerText}>
          Thank you for shopping with Go Cart!
        </Text>

        <Text style={styles.body1Text}>
          Your e-receipt is available in the mobile app.
        </Text>

        <Text style={styles.body1Text}>Redirecting in {successSeconds}</Text>

        <Text style={styles.body2Text}>Have a great day, shopper!</Text>
      </View>
    </>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    alignItems: "center",
    backgroundColor: "#0FA958",
    justifyContent: "center",
  },
  image: {
    width: "60%",
    height: 116,
    resizeMode: "contain",
  },
  headerText: {
    marginTop: 100,
    fontSize: 45,
    width: 600,
    fontFamily: "GothamMedium",
    textAlign: "center",
    color: "white",
  },
  body1Text: {
    marginTop: 100,
    fontSize: 25,
    color: "white",
    fontFamily: "GothamBook",
  },
  body2Text: {
    marginTop: 100,
    fontSize: 25,
    color: "white",
    fontFamily: "GothamMedium",
  },
});

export default PaymentSuccess;
